<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>The Sims - Start Screen</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Saira+Semi+Condensed:wght@600;700&family=Varela+Round&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css?v=hall-pan-4" />
  </head>
  <body>
    <div class="sky">
      <div class="hall" aria-hidden="true">
        <div class="hall-ceiling"></div>
        <div class="hall-wall hall-wall-left"></div>
        <div class="hall-wall hall-wall-right"></div>
        <div class="hall-floor"></div>
        <div class="hall-light"></div>
        <div class="hall-glow"></div>
      </div>
      <main class="screen" role="main">
        <div class="logo">
          <span class="logo-top">THE</span>
          <span class="logo-main">SIMS</span>
          <span class="logo-sub">Start Screen</span>
        </div>
        <p class="tagline">Build a life. Drift among the clouds.</p>
        <div class="actions">
          <button class="start bubble-sheen" type="button" aria-label="Start the game">
            Start
          </button>
          <span class="hint">Click start to begin your story.</span>
        </div>
      </main>
      <div class="audio-controls" role="group" aria-label="Background audio controls">
        <div class="mixer-shell">
          <div class="mixer-knob">
            <button class="mute-toggle" id="mute-toggle" type="button" aria-pressed="false">
              <span class="mute-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="presentation" focusable="false">
                  <path
                    d="M11 4.5L6.7 8H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.7L11 19.5a1 1 0 0 0 1.6-.8V5.3A1 1 0 0 0 11 4.5Z"
                    fill="currentColor"
                  />
                  <path
                    d="M16.5 8.5a1 1 0 0 1 1.4 0 6 6 0 0 1 0 7.1 1 1 0 1 1-1.4-1.4 4 4 0 0 0 0-4.3 1 1 0 0 1 0-1.4Z"
                    fill="currentColor"
                  />
                </svg>
              </span>
              <span class="mute-text" id="mute-text">Mute</span>
            </button>
          </div>
          <div class="mixer-display">
            <div class="mixer-header">
              <span class="mixer-title">Sound Mixer</span>
              <span class="mixer-status" id="mixer-status">Ambient</span>
            </div>
            <label class="volume-control">
              <span class="volume-label">Volume</span>
              <input
                class="volume-slider"
                id="volume"
                type="range"
                min="0"
                max="1"
                step="0.01"
                value="0.45"
                aria-label="Background audio volume"
              />
            </label>
            <div class="volume-meter" aria-hidden="true">
              <span class="meter-fill" id="volume-meter"></span>
            </div>
          </div>
        </div>
      </div>
      <audio
        id="bg-audio"
        src="assets/audio/calm-water-tracks.mp3"
        preload="auto"
        loop
        autoplay
        playsinline
      ></audio>
    </div>
    <script>
      const setupAudio = () => {
        const audio = document.getElementById("bg-audio");
        const volume = document.getElementById("volume");
        const muteToggle = document.getElementById("mute-toggle");
        const muteText = document.getElementById("mute-text");
        const meter = document.getElementById("volume-meter");
        const status = document.getElementById("mixer-status");

        if (!audio || !volume || !muteToggle || !muteText) {
          return;
        }

        let lastVolume = parseFloat(volume.value);
        let autoMuted = false;
        if (!Number.isFinite(lastVolume) || lastVolume <= 0) {
          lastVolume = 0.45;
          volume.value = lastVolume.toString();
        }

        const updateMuteUI = () => {
          const isMuted = audio.muted || audio.volume === 0;
          muteToggle.setAttribute("aria-pressed", String(isMuted));
          muteText.textContent = isMuted ? "Unmute" : "Mute";
          if (status) {
            status.textContent = isMuted ? "Muted" : "Ambient";
          }
          if (meter) {
            meter.style.width = `${Math.round((isMuted ? 0 : audio.volume) * 100)}%`;
          }
        };

        const setVolume = (value) => {
          const nextVolume = Math.max(0, Math.min(1, value));
          audio.volume = nextVolume;
          if (nextVolume === 0) {
            audio.muted = true;
          } else if (audio.muted) {
            audio.muted = false;
          }
          if (nextVolume > 0) {
            lastVolume = nextVolume;
            autoMuted = false;
          }
          updateMuteUI();
        };

        setVolume(parseFloat(volume.value));

        const enableAudio = () => {
          if (autoMuted && audio.volume > 0) {
            audio.muted = false;
            autoMuted = false;
          }
          if (audio.volume === 0) {
            setVolume(lastVolume);
            volume.value = audio.volume.toString();
          }
          updateMuteUI();
          audio.play().catch(() => {});
        };

        const tryPlay = () => {
          const attempt = audio.play();
          if (attempt && typeof attempt.catch === "function") {
            attempt.catch(() => {
              autoMuted = true;
              audio.muted = true;
              updateMuteUI();
              audio.play().catch(() => {});
            });
          }
        };

        tryPlay();

        volume.addEventListener("input", (event) => {
          setVolume(parseFloat(event.target.value));
        });

        muteToggle.addEventListener("click", () => {
          const wasMuted = audio.muted || audio.volume === 0;
          if (wasMuted) {
            audio.muted = false;
            if (audio.volume === 0) {
              setVolume(lastVolume);
              volume.value = audio.volume.toString();
            }
            autoMuted = false;
          } else {
            audio.muted = true;
          }
          updateMuteUI();
          audio.play().catch(() => {});
        });

        document.addEventListener(
          "pointerdown",
          () => {
            enableAudio();
          },
          { once: true }
        );

        const startButton = document.querySelector(".start");
        if (startButton) {
          startButton.addEventListener("click", () => {
            enableAudio();
          });
        }
      };

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", setupAudio);
      } else {
        setupAudio();
      }
    </script>
  </body>
</html>
